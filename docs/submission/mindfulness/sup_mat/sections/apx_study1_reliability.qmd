
To compute the multilevel reliability indices presented in the manuscript, we applied a multilevel confirmatory factor analysis (MCFA) approach as described by Lai (2021). This method allows for the separation of variability at different levels—within and between subjects—and the computation of reliability indices using factor loadings and variance components.

### Reliability Indices

We computed three types of reliability measures for the CS and UCS components of state self-compassion:

1. **Between-subject reliability ($\tilde{\omega}^b$)**: Reflects the scale's ability to distinguish stable individual differences across participants.
2. **Within-subject reliability ($\tilde{\omega}^w$)**: Indicates the consistency of scores across repeated measures for the same participant, accounting for dynamic changes over time.
3. **Overall composite reliability ($\omega^{2L}$)**: Combines within- and between-subject variances to provide a measure of the scale's overall reliability.

These indices were derived by fitting an MCFA model to the data.

### Code Implementation

The analysis was implemented in R using the `lavaan` package for structural equation modeling and the `semTools` package to compute reliability indices. 

```r
get_ssc_reliabilities <- function(input_path, output_path) {
  
  suppressPackageStartupMessages({
    library("dplyr")
    library("lavaan")
    library("semTools")
  })
  
  both_df <- readRDS(input_path)

  process_ssc_data <- function(df, mcfa_model) {
    suppressWarnings({
      fit <- cfa(mcfa_model, data = df, cluster = "person")
      comp_rel <- compRelSEM(
        fit,
        obs.var = FALSE, config = c("f1"), shared = "f1"
      )
    })
    return(comp_rel)
  }

  # Define the multilevel SEM model
  mcfa_model <-
    "
    level: 1
    f1 =~ NA * i1 + l1 * i1 + l2 * i2 + l3 * i3 + l4 * i4
    i1 ~~ ev1w * i1
    i2 ~~ ev2w * i2
    i3 ~~ ev3w * i3
    i4 ~~ ev4w * i4
    f1 ~~ 1 * f1
    
    level: 2
    f1 =~ NA * i1 + l1 * i1 + l2 * i2 + l3 * i3 + l4 * i4
    # fixed residual variances
    i1 ~~ ev1b * i1
    i2 ~~    0 * i2
    i3 ~~ ev3b * i3
    i4 ~~ ev4b * i4
    f1 ~~ vf1b * f1
    
    # tilde omega values:
    tilomgb := (l1 + l2 + l3 + l4)^2 * vf1b /
      ((l1 + l2 + l3 + l4)^2 * vf1b + ev1b + 0 + ev3b + ev4b)
    tilomgw := (l1 + l2 + l3 + l4)^2 * 1 /
      ((l1 + l2 + l3 + l4)^2 * 1 + ev1w + ev2w + ev3w + ev4w)
    # score reliability:
    omg2l := (l1 + l2 + l3 + l4)^2 * (1 + vf1b) /
      ((l1 + l2 + l3 + l4)^2 * (1 + vf1b) + 
         ev1b + 0 + ev3b + ev4b + ev1w + ev2w + ev3w + ev4w)
    omgb := (l1 + l2 + l3 + l4)^2 * vf1b /
      ((l1 + l2 + l3 + l4)^2 * vf1b + ev1b + 0 + ev3b + ev4b + 
         (ev1w + ev2w + ev3w + ev4w + (l1 + l2 + l3 + l4)^2) / 25.1)
  "

  # Prepare data
  pos_ssc_df <- both_df %>% select(user_id, starts_with("scs_pos"))
  neg_ssc_df <- both_df %>% select(user_id, starts_with("scs_neg"))
  colnames(pos_ssc_df) <- c("person", "i1", "i2", "i3", "i4")
  colnames(neg_ssc_df) <- c("person", "i1", "i2", "i3", "i4")

  # Calculate reliabilities
  pos_reliabilities <- process_ssc_data(pos_ssc_df, mcfa_model)
  neg_reliabilities <- process_ssc_data(neg_ssc_df, mcfa_model)

  # Format and return results
  results <- list(
    positive = pos_reliabilities,
    negative = neg_reliabilities
  )

  saveRDS(results, output_path)
}
```

Below is a summary of the main steps in the R script:

1. **Model Specification**:  
   The MCFA model defines a single latent factor (`f1`) at both levels:
   - **Level 1 (within-subject)**: Captures variability across repeated measures within participants.
   - **Level 2 (between-subject)**: Captures stable individual differences across participants.
   Residual variances and factor loadings were constrained as appropriate, and reliability indices ($\tilde{\omega}^b$, $\tilde{\omega}^w$, $\omega^{2L}$) were explicitly defined within the model.

2. **Data Preparation**:  
   The input dataset contains repeated measures of four items (`i1` to `i4`) for each participant. Two subsets were created: one for the CS and one for the UCS components of state self-compassion. 

### Results

Using this method, we obtained the following reliability estimates:

- **CS**: Between-subject ($\tilde{\omega}^b$) = 0.82, Within-subject ($\tilde{\omega}^w$) = 0.63, Composite ($\omega^{2L}$) = 0.79.
- **UCS**: Between-subject ($\tilde{\omega}^b$) = 0.88, Within-subject ($\tilde{\omega}^w$) = 0.68, Composite ($\omega^{2L}$) = 0.83.

These results demonstrate that the state self-compassion scale effectively captures both stable individual differences and dynamic within-subject variability over time.


